{% extends "base.html" %}
{% block title %}新規報告書作成 | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">🆕 新規報告書作成</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<form method="POST" action="/admin/reports/new" style="max-width: 1200px;">
  <div style="margin-bottom: 20px; padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08);">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
      {% if copy_from_report %}
      <div style="margin-bottom: 20px; padding: 12px; background: #e3f2fd; border-radius: 8px; border: 1px solid #90caf9;">
        <p style="margin: 0; font-size: 0.9rem; color: #1565c0;">
          <strong>📋 既存の報告書から複製しています</strong><br>
          現場「{{ copy_from_report.field_name }}」の最新報告書の情報を初期値として設定しています。必要に応じて編集してください。
        </p>
      </div>
      {% endif %}
      
      <!-- 左列 -->
      <div style="display: flex; flex-direction: column; gap: 20px;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">現場名（必須）</label>
          <input type="text" name="field_name" value="{% if copy_from_report %}{{ copy_from_report.field_name }}{% endif %}" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">場所</label>
          <input type="text" name="place" value="{% if copy_from_report and copy_from_report.place %}{{ copy_from_report.place }}{% endif %}" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">対応スタッフ（複数選択可）</label>
          <div style="display: flex; flex-direction: column; gap: 10px; padding: 12px; background: #f5f7fb; border-radius: 8px; border: 1px solid #e0e0e0;">
            {% for staff in staff_list %}
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 6px 0;">
              <input type="checkbox" name="staff_names" value="{{ staff.name }}" {% if copy_from_report and copy_from_report.staff_names and staff.name in copy_from_report.staff_names %}checked{% endif %} style="width: 18px; height: 18px; cursor: pointer;">
              <span style="font-size: 0.95rem; color: #333;">{{ staff.name }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- 右列 -->
      <div style="display: flex; flex-direction: column; gap: 20px;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">日付（必須）</label>
          <input type="date" name="report_date" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">開始時間</label>
            <input type="time" name="start_time" value="{% if copy_from_report and copy_from_report.start_time %}{{ copy_from_report.start_time }}{% else %}07:00{% endif %}" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">終了時間</label>
            <input type="time" name="end_time" value="{% if copy_from_report and copy_from_report.end_time %}{{ copy_from_report.end_time }}{% else %}22:00{% endif %}" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
          </div>
        </div>
        <div style="padding: 12px; background: #f0f7ff; border-radius: 8px; border: 1px solid #b3d9ff;">
          <p style="margin: 0; font-size: 0.9rem; color: #1E3A5F;">
            <strong>列数について：</strong><br>
            対応スタッフの人数に応じて自動的に列数が設定されます。<br>
            1名の場合は2列（スタッフ名・施術内容）、2名以上の場合はスタッフ名の列が作成されます。
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <div style="display: flex; gap: 12px; margin-top: 30px;">
    <button type="submit" class="admin-karte-detail-btn-primary" style="border: none; cursor: pointer;">💾 作成</button>
    <a href="/admin/reports" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block; text-align: center;">← 一覧に戻る</a>
  </div>
</form>

{% endblock %}

