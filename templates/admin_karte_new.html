{% extends "base.html" %}
{% block title %}æ–°è¦ã‚«ãƒ«ãƒ†ä½œæˆ | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">â• æ–°è¦ã‚«ãƒ«ãƒ†ä½œæˆ</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 12px; padding: 10px; border-radius: 6px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %}; font-size: 0.9rem;">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<form method="POST" action="/admin/karte/new" class="admin-karte-form">
  <!-- åå‰ãƒ»ãƒ•ãƒªã‚¬ãƒŠï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-row">
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">åå‰</label>
        <input type="text" name="name" class="admin-form-input" placeholder="æ‚£è€…åã‚’å…¥åŠ›">
      </div>
    </div>
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">ãƒ•ãƒªã‚¬ãƒŠ</label>
        <input type="text" name="kana" class="admin-form-input" placeholder="ãƒ•ãƒªã‚¬ãƒŠã‚’å…¥åŠ›">
      </div>
    </div>
  </div>
  
  <!-- ç”Ÿå¹´æœˆæ—¥ãƒ»æ€§åˆ¥ï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-row">
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">ç”Ÿå¹´æœˆæ—¥</label>
        <input type="date" name="birthday" class="admin-form-input">
      </div>
    </div>
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">æ€§åˆ¥</label>
        <select name="gender" class="admin-form-select">
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="ç”·æ€§">ç”·æ€§</option>
          <option value="å¥³æ€§">å¥³æ€§</option>
          <option value="ãã®ä»–">ãã®ä»–</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- åŒºåˆ†ãƒ»é›»è©±ç•ªå·ï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-row">
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">åŒºåˆ†</label>
        <select name="category" class="admin-form-select">
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
          <option value="ã‚¹ãƒãƒ¼ãƒ„é¸æ‰‹">ã‚¹ãƒãƒ¼ãƒ„é¸æ‰‹</option>
          <option value="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</option>
        </select>
      </div>
    </div>
    <div class="admin-form-col">
      <div class="admin-form-field">
        <label class="admin-form-label">é›»è©±ç•ªå·</label>
        <input type="text" name="phone" class="admin-form-input" placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›">
      </div>
    </div>
  </div>
  
  <!-- ãƒ¡ãƒ¼ãƒ«ï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-field">
    <label class="admin-form-label">ãƒ¡ãƒ¼ãƒ«</label>
    <input type="email" name="email" class="admin-form-input" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›">
  </div>
  
  <!-- éƒµä¾¿ç•ªå·ï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-field">
    <label class="admin-form-label">éƒµä¾¿ç•ªå·</label>
    <input type="text" name="postal_code" class="admin-form-input" placeholder="éƒµä¾¿ç•ªå·ã‚’å…¥åŠ›">
  </div>
  
  <!-- ä½æ‰€ï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-field">
    <label class="admin-form-label">ä½æ‰€</label>
    <input type="text" name="address" class="admin-form-input" placeholder="ä½æ‰€ã‚’å…¥åŠ›">
  </div>
  
  <!-- ç´¹ä»‹è€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="admin-form-field">
    <label class="admin-form-label">ç´¹ä»‹è€…ï¼ˆè‡ªç”±è¨˜å…¥ï¼‰</label>
    <input type="text" name="introducer" class="admin-form-input" placeholder="ç´¹ä»‹è€…åã‚’å…¥åŠ›">
  </div>
  
  <div class="admin-form-field">
    <label class="admin-form-label">ç´¹ä»‹è€…ï¼ˆæ¤œç´¢ã—ã¦é¸æŠï¼‰</label>
    <input type="text" id="introducer_search" placeholder="åå‰ãƒ»ãƒ•ãƒªã‚¬ãƒŠã§æ¤œç´¢" class="admin-form-input">
    <select id="introducer_select" name="introduced_by_patient_id" size="6" class="admin-form-select">
      <option value="">é¸æŠãªã—</option>
      {% for p in all_patients %}
        <option value="{{ p.id }}">{{ p.id }}ï¼š{{ p.name }}ï¼ˆ{{ p.kana }}ï¼‰</option>
      {% endfor %}
    </select>
  </div>
  
  <!-- ä¸»è¨´ï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-field">
    <label class="admin-form-label">ä¸»è¨´</label>
    <textarea name="chief_complaint" rows="2" class="admin-form-textarea" placeholder="ä¸»è¨´ã‚’å…¥åŠ›"></textarea>
  </div>
  
  <!-- å‚™è€ƒï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰ -->
  <div class="admin-form-field">
    <label class="admin-form-label">å‚™è€ƒ</label>
    <textarea name="note" rows="3" class="admin-form-textarea" placeholder="å‚™è€ƒã‚’å…¥åŠ›"></textarea>
  </div>
  
  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
  <div class="admin-form-actions">
    <button type="submit" class="admin-karte-detail-btn-primary">ğŸ’¾ ä¿å­˜</button>
    <a href="/admin/karte" class="admin-karte-detail-btn-back">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
  </div>
</form>

<script>
document.getElementById("introducer_search").addEventListener("input", function() {
  const q = this.value.toLowerCase();
  const options = document.querySelectorAll("#introducer_select option");

  options.forEach(op => {
    const text = op.textContent.toLowerCase();
    op.style.display = text.includes(q) ? "block" : "none";
  });
});
</script>

{% endblock %}
