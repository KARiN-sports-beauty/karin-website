{% extends "base.html" %}
{% block title %}è«‹æ±‚æ›¸ç·¨é›† - {{ invoice.invoice_number }} | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">âœ è«‹æ±‚æ›¸ç·¨é›†</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
  <a href="/admin/invoices/{{ invoice.id }}" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block; text-align: center; margin-right: 12px;">â† è©³ç´°ã«æˆ»ã‚‹</a>
</div>

<form method="POST" action="/admin/invoices/{{ invoice.id }}/edit" style="max-width: 800px;">
  <div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
    <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">åŸºæœ¬æƒ…å ±</h3>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">è«‹æ±‚å…ˆï¼ˆç¾å ´åï¼‰</label>
      <input type="text" value="{{ invoice.place_name }}" disabled style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; background: #f5f5f5; color: #666;">
      <p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #666;">ç¾å ´åã¯å¤‰æ›´ã§ãã¾ã›ã‚“</p>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">è«‹æ±‚å…ˆä½æ‰€</label>
      <input type="text" name="place_address" value="{{ invoice.place_address or (place_info.address if place_info else '') }}" placeholder="è«‹æ±‚å…ˆã®ä½æ‰€ã‚’å…¥åŠ›" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
      <p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #666;">åŒã˜ç¾å ´åã§æ¬¡å›ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™</p>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">è«‹æ±‚å…ˆé›»è©±ç•ªå·</label>
      <input type="text" name="place_phone" value="{{ invoice.place_phone or (place_info.phone if place_info else '') }}" placeholder="è«‹æ±‚å…ˆã®é›»è©±ç•ªå·ã‚’å…¥åŠ›" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">æ‹…å½“è€…å</label>
      <input type="text" name="place_contact_person" value="{{ invoice.place_contact_person or (place_info.contact_person if place_info else '') }}" placeholder="æ‹…å½“è€…åã‚’å…¥åŠ›" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">ç™ºè¡Œæ—¥</label>
        <input type="date" name="issue_date" value="{{ invoice.issue_date }}" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
      </div>
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">æ”¯æ‰•æœŸé™</label>
        <input type="date" name="due_date" value="{{ invoice.due_date }}" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
      </div>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">çŠ¶æ…‹</label>
      <select name="status" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
        <option value="draft" {% if invoice.status == 'draft' %}selected{% endif %}>æœªä½œæˆ</option>
        <option value="sent" {% if invoice.status == 'sent' %}selected{% endif %}>ç™ºé€æ¸ˆã¿</option>
        <option value="paid" {% if invoice.status == 'paid' %}selected{% endif %}>å…¥é‡‘æ¸ˆã¿</option>
      </select>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">ç™ºé€æ—¥</label>
        <input type="date" name="sent_at" value="{{ invoice.sent_at or '' }}" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
      </div>
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">å…¥é‡‘æ—¥</label>
        <input type="date" name="paid_at" value="{{ invoice.paid_at or '' }}" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;">
      </div>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">å‚™è€ƒ</label>
      <textarea name="notes" rows="4" placeholder="å‚™è€ƒã‚’å…¥åŠ›" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; font-family: inherit;">{{ invoice.notes or '' }}</textarea>
    </div>
  </div>
  
  <!-- æ˜ç´°ï¼ˆç·¨é›†ä¸å¯ã€å‚è€ƒè¡¨ç¤ºï¼‰ -->
  <div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
    <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">è«‹æ±‚æ˜ç´°</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f5f7fb; border-bottom: 2px solid #1E3A5F;">
          <th style="padding: 12px; text-align: left; font-weight: 600; color: #1E3A5F; border-right: 1px solid #ddd;">æ—¥ä»˜</th>
          <th style="padding: 12px; text-align: left; font-weight: 600; color: #1E3A5F; border-right: 1px solid #ddd;">å†…å®¹</th>
          <th style="padding: 12px; text-align: right; font-weight: 600; color: #1E3A5F;">é‡‘é¡</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr style="border-bottom: 1px solid #f0f0f0;">
          <td style="padding: 12px; border-right: 1px solid #ddd;">{{ item.report_date }}</td>
          <td style="padding: 12px; border-right: 1px solid #ddd;">{{ item.description or 'ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼å¸¯åŒ' }}</td>
          <td style="padding: 12px; text-align: right; font-weight: 600;">Â¥{{ "{:,}".format(item.amount) }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr style="background: #f5f7fb; border-top: 2px solid #1E3A5F;">
          <td colspan="2" style="padding: 12px; font-weight: 600; color: #1E3A5F;">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</td>
          <td style="padding: 12px; text-align: right; font-weight: 600; color: #1E3A5F; font-size: 1.1rem;">Â¥{{ "{:,}".format(invoice.total_amount) }}</td>
        </tr>
      </tfoot>
    </table>
    <p style="margin: 16px 0 0 0; font-size: 0.85rem; color: #666;">æ˜ç´°ã¯æ—¥å ±ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚å¤‰æ›´ã™ã‚‹å ´åˆã¯æ—¥å ±ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚</p>
  </div>
  
  <div style="display: flex; gap: 12px;">
    <button type="submit" class="admin-karte-detail-btn-primary" style="border: none; cursor: pointer;">ğŸ’¾ ä¿å­˜</button>
    <a href="/admin/invoices/{{ invoice.id }}" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block; text-align: center;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
  </div>
</form>

{% endblock %}

