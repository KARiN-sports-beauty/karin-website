{% extends "base.html" %}
{% block title %}ãƒ–ãƒ­ã‚°ç®¡ç† | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ“ ãƒ–ãƒ­ã‚°ç®¡ç†</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
  <a href="/admin/blogs/new" class="admin-blog-btn">ğŸ†• æ–°è¦ãƒ–ãƒ­ã‚°ä½œæˆ</a>
</div>

{% if blogs %}
<div class="admin-blog-grid">
  {% for blog in blogs %}
  <div class="admin-blog-card{% if blog.draft %} replied{% else %} unread{% endif %}">
    <div class="admin-blog-head">
      <strong>{{ blog.title }}</strong>
      <span class="admin-blog-date">{{ to_jst(blog.created_at) }}</span>
    </div>
    
    {% if blog.category %}
    <p class="admin-blog-category">ã‚«ãƒ†ã‚´ãƒª: {{ blog.category }}</p>
    {% endif %}
    
    <p class="admin-blog-body">
      {% if blog.excerpt %}
        {{ blog.excerpt[:30] }}{% if blog.excerpt|length > 30 %}...{% endif %}
      {% else %}
      {{ blog.body
        |striptags
        |replace("\n", "")
        |replace("&nbsp;", "")
        |truncate(40)
      }}
      {% endif %}
    </p>
    
    <div class="admin-blog-actions">
      <span class="admin-blog-status{% if blog.draft %} draft{% else %} published{% endif %}">
        {% if blog.draft %}ğŸ“ ä¸‹æ›¸ã{% else %}ğŸ“¢ å…¬é–‹{% endif %}
      </span>
      {% if blog.slug %}
      <a href="/blog/{{ blog.slug }}" target="_blank" class="admin-blog-view-link">ğŸ”— è¡¨ç¤º</a>
      {% endif %}
    </div>
    
    <div class="admin-blog-buttons">
      <a href="/admin/blogs/edit/{{ blog.id }}" class="reply-btn">âœ ç·¨é›†</a>
      <form action="/admin/blogs/delete/{{ blog.id }}" method="POST" style="display: inline;" onsubmit="return confirm('ã“ã®ãƒ–ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå…ƒã«ã¯æˆ»ã›ã¾ã›ã‚“ï¼‰');">
        <button type="submit" class="admin-blog-delete-btn">ğŸ—‘ å‰Šé™¤</button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>ãƒ–ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}

{% endblock %}
