{% extends "base.html" %}
{% block title %}ã‚»ãƒ«ãƒ•ã‚±ã‚¢å‹•ç”» - æ–°è¦ä½œæˆ | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ†• ã‚»ãƒ«ãƒ•ã‚±ã‚¢å‹•ç”» - æ–°è¦ä½œæˆ</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
  <a href="/admin/videos" class="admin-karte-detail-btn-back" style="text-decoration: none;">â† ã‚»ãƒ«ãƒ•ã‚±ã‚¢å‹•ç”»ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>

<form method="POST" action="/admin/videos/new" enctype="multipart/form-data" style="max-width: 800px;">
  <div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">ç¨®ç›®å<span style="color: #f44336;">*</span></label>
      <input type="text" name="name" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;" placeholder="ä¾‹ï¼šè‚©ç”²éª¨ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒ">
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">å‹•ç”»URLã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<span style="color: #f44336;">*</span></label>
      <input type="text" name="video_url" id="video_url" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-bottom: 8px;" placeholder="YouTube URLã€Vimeo URLã€ã¾ãŸã¯Supabase Storage URL">
      <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">ã¾ãŸã¯</p>
      <input type="file" name="video_file" id="video_file" accept="video/*" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box;" onchange="handleFileSelect(event)">
      <p style="font-size: 0.85rem; color: #666; margin-top: 8px;">â€»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãŸå ´åˆã€URLå…¥åŠ›æ¬„ã¯ç„¡è¦–ã•ã‚Œã¾ã™</p>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">ç›®çš„</label>
      <textarea name="purpose" rows="3" placeholder="ã“ã®å‹•ç”»ã®ç›®çš„ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; font-family: inherit;"></textarea>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">æ–¹æ³•</label>
      <textarea name="method" rows="5" placeholder="å®Ÿæ–½æ–¹æ³•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; font-family: inherit;"></textarea>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1E3A5F; font-size: 0.95rem;">ã“ã®ã‚ˆã†ãªæ–¹ã«ãŠã™ã™ã‚</label>
      <textarea name="recommended_for" rows="3" placeholder="ä¾‹ï¼šè‚©ã“ã‚ŠãŒæ°—ã«ãªã‚‹æ–¹ã€ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯ãŒå¤šã„æ–¹ãªã©" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; font-family: inherit;"></textarea>
    </div>
    
    <div style="margin-top: 24px;">
      <button type="submit" class="admin-karte-detail-btn-primary" style="border: none; cursor: pointer; padding: 12px 24px; font-size: 1rem;">ç™»éŒ²</button>
      <a href="/admin/videos" class="admin-karte-detail-btn-back" style="text-decoration: none; margin-left: 12px; padding: 12px 24px; display: inline-block;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
    </div>
  </div>
</form>

<script>
function handleFileSelect(event) {
  const fileInput = event.target;
  const urlInput = document.getElementById('video_url');
  
  if (fileInput.files && fileInput.files.length > 0) {
    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸå ´åˆã€URLå…¥åŠ›æ¬„ã‚’ç„¡åŠ¹åŒ–ï¼ˆå¿…é ˆãƒã‚§ãƒƒã‚¯ã‚’å›é¿ï¼‰
    urlInput.required = false;
    urlInput.disabled = true;
    urlInput.placeholder = "ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€URLå…¥åŠ›ã¯ä¸è¦ã§ã™";
  } else {
    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã€URLå…¥åŠ›æ¬„ã‚’æœ‰åŠ¹åŒ–
    urlInput.required = true;
    urlInput.disabled = false;
    urlInput.placeholder = "YouTube URLã€Vimeo URLã€ã¾ãŸã¯Supabase Storage URL";
  }
}

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
document.querySelector('form').addEventListener('submit', function(e) {
  const fileInput = document.getElementById('video_file');
  const urlInput = document.getElementById('video_url');
  
  if (!fileInput.files || fileInput.files.length === 0) {
    if (!urlInput.value.trim()) {
      e.preventDefault();
      alert('å‹•ç”»URLã‚’å…¥åŠ›ã™ã‚‹ã‹ã€å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
      return false;
    }
  }
});
</script>

{% endblock %}

