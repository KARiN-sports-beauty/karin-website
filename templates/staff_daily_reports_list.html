{% extends "base.html" %}
{% block title %}éå»ã®æ—¥å ± - {{ year }}å¹´{{ month_name }} | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ“… éå»ã®æ—¥å ± - {{ year }}å¹´{{ month_name }}</h2>

<div style="margin-bottom: 20px;">
  <a href="/staff/daily-reports/years/{{ year }}" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block; text-align: center; margin-bottom: 12px;">â† æœˆä¸€è¦§ã«æˆ»ã‚‹</a>
</div>

{% if reports %}
<div style="display: flex; flex-direction: column; gap: 20px;">
  {% for report in reports %}
  <div style="padding: 20px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08);">
    <!-- æ—¥å ±ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
      <div>
        <div style="font-size: 1.2rem; font-weight: 600; color: #1E3A5F; margin-bottom: 4px;">{{ report.report_date }}</div>
        <div style="font-size: 1rem; font-weight: 500; color: #1E3A5F;">{{ staff_name }}</div>
      </div>
      <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
        <div style="font-size: 0.85rem; color: #999;">
          ç™»éŒ²æ—¥æ™‚ï¼š{{ report.created_at[:16] if report.created_at else '' }}
        </div>
        <a href="/staff/daily-report/new?date={{ report.report_date }}" style="padding: 6px 16px; background: #1E3A5F; color: #fff; text-decoration: none; border-radius: 6px; font-size: 0.9rem; font-weight: 500; transition: background 0.2s ease;" onmouseover="this.style.background='#2a4a6f'" onmouseout="this.style.background='#1E3A5F'">
          ç·¨é›†
        </a>
      </div>
    </div>
    
    {% if report.memo %}
    <div style="margin-bottom: 16px; padding: 12px; background: #f5f7fb; border-radius: 8px; font-size: 0.9rem; color: #666;">
      <strong style="color: #1E3A5F;">æœ¬æ—¥ã®ã‚·ãƒ•ãƒˆï¼š</strong>{{ report.memo }}
    </div>
    {% endif %}
    
    <!-- å‹¤å‹™ã‚«ãƒ¼ãƒ‰ä¸€è¦§ -->
    {% if report.items %}
    <div style="display: flex; flex-direction: column; gap: 12px;">
      {% for item in report.items %}
      <div class="admin-resv-card {% if item.work_type == 'in_house' %}place-inhouse{% elif item.work_type == 'visit' %}place-visit{% elif item.work_type == 'field' %}place-field{% endif %}">
        <!-- å‹¤å‹™åŒºåˆ†ãƒãƒƒã‚¸ï¼ˆå¿…ãšè¡¨ç¤ºï¼‰ -->
        <div style="margin-bottom: 12px;">
          <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
            {% if item.work_type == 'in_house' %}
            <span style="padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; background: #1E3A5F; color: #fff;">é™¢å†…</span>
            {% elif item.work_type == 'visit' %}
            <span style="padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; background: #4CAF50; color: #fff;">å¾€è¨º</span>
            {% elif item.work_type == 'field' %}
            <span style="padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; background: #FFB6C1; color: #fff;">å¸¯åŒ</span>
            {% endif %}
            {% if item.start_time_display and item.end_time_display %}
            <span style="color: #666; font-size: 0.9rem;">{{ item.start_time_display }} ï½ {{ item.end_time_display }}</span>
            {% elif item.start_time_display %}
            <span style="color: #666; font-size: 0.9rem;">é–‹å§‹ï¼š{{ item.start_time_display }}</span>
            {% elif item.end_time_display %}
            <span style="color: #666; font-size: 0.9rem;">çµ‚äº†ï¼š{{ item.end_time_display }}</span>
            {% endif %}
            {% if item.break_minutes and item.break_minutes > 0 %}
            <span style="color: #666; font-size: 0.9rem;">ä¼‘æ†©ï¼š{{ item.break_minutes }}åˆ†</span>
            {% endif %}
            {% if item.session_count and item.session_count > 0 %}
            <span style="color: #666; font-size: 0.9rem;">æœ¬æ•°ï¼š{{ item.session_count }}</span>
            {% endif %}
          </div>
        </div>
        
        {% if item.memo %}
        <div style="margin-bottom: 12px; padding: 8px; background: #fff; border-radius: 6px; font-size: 0.9rem; color: #666;">
          {{ item.memo }}
        </div>
        {% endif %}
        
        <!-- æ‚£è€…ãƒ»å£²ä¸Šæ˜ç´°ï¼ˆé‡‘é¡0å††ã§ã‚‚å¿…ãšè¡¨ç¤ºï¼‰ -->
        {% if item.patients %}
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">
          <div style="font-size: 0.85rem; font-weight: 600; color: #1E3A5F; margin-bottom: 8px;">æ‚£è€…ãƒ»å£²ä¸Šæ˜ç´°</div>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            {% for patient in item.patients %}
            <div style="padding: 8px; background: #f5f7fb; border-radius: 6px; font-size: 0.85rem;">
              {% if patient.patient_id %}
              <a href="/admin/karte/{{ patient.patient_id }}" style="color: #1E3A5F; text-decoration: none; font-weight: 500;">
                {% if patient.patient_name %}
                  {{ patient.patient_name }}
                {% else %}
                  æ‚£è€…ID: {{ patient.patient_id[:8] }}...
                {% endif %}
              </a>
              {% else %}
              <span style="color: #999;">æ‚£è€…æƒ…å ±ãªã—</span>
              {% endif %}
              {% if patient.course_name %}
              <span style="color: #666; font-weight: 500;">ï½œ{{ patient.course_name }}</span>
              {% else %}
              <span style="color: #999; font-size: 0.8rem;">ï½œã‚³ãƒ¼ã‚¹åãªã—</span>
              {% endif %}
              {% if patient.amount is not none %}
              <span style="color: {% if patient.amount == 0 %}#999{% else %}#4CAF50{% endif %}; font-weight: {% if patient.amount == 0 %}400{% else %}500{% endif %};">
                ï½œÂ¥{{ "{:,}".format(patient.amount) }}
              </span>
              {% else %}
              <span style="color: #999; font-size: 0.8rem;">ï½œé‡‘é¡æœªè¨­å®š</span>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p style="color: #999; text-align: center; padding: 20px 0;">å‹¤å‹™ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% else %}
<p style="color: #999; text-align: center; padding: 40px 0;">{{ year }}å¹´{{ month_name }}ã®æ—¥å ±ãŒã‚ã‚Šã¾ã›ã‚“</p>
{% endif %}
{% endblock %}
