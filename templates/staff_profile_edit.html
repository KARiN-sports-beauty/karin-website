<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>プロフィール編集 | KARiN.</title>
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
<link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">

<style>
.profile-wrapper {
  max-width: 800px;
  margin: 60px auto;
  padding: 32px;
  background: #ffffff;
  border-radius: 18px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.profile-title {
  text-align: center;
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 32px;
  color: #1E3A5F;
}

.form-group {
  margin-bottom: 24px;
}

.form-group label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #1E3A5F;
  margin-bottom: 8px;
}

.form-group label.required::after {
  content: " *";
  color: #c65a3a;
}

.input, .textarea, .select {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ddd;
  box-sizing: border-box;
  font-family: inherit;
}

.textarea {
  resize: vertical;
  min-height: 100px;
}

.input[readonly] {
  background: #f5f5f5;
  cursor: not-allowed;
}

.input:focus, .textarea:focus, .select:focus {
  outline: none;
  border-color: #1E3A5F;
  box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-group.full-width {
  grid-column: 1 / -1;
}

.photo-upload {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 24px;
  padding: 20px;
  background: #f5f7fb;
  border-radius: 12px;
}

.photo-preview {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #1E3A5F;
  background: #fff;
}

.photo-upload-info {
  flex: 1;
}

.photo-upload-info p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #666;
}

.techniques-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
  margin-top: 8px;
}

.technique-checkbox {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #f5f7fb;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s;
}

.technique-checkbox:hover {
  background: #e8ecf3;
}

.technique-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #1E3A5F;
}

.technique-checkbox label {
  margin: 0;
  font-weight: 400;
  cursor: pointer;
  flex: 1;
}

.save-btn {
  width: 100%;
  padding: 14px 0;
  background: #1E3A5F;
  color: #fff;
  border: none;
  border-radius: 8px;
  margin-top: 32px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: background 0.2s;
}

.save-btn:hover {
  background: #16304A;
}

.success-msg {
  color: #4CAF50;
  margin-bottom: 16px;
  text-align: center;
  padding: 12px;
  background: #d4edda;
  border-radius: 8px;
}

@media (max-width: 768px) {
  .profile-wrapper {
    padding: 20px;
    margin: 20px;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .techniques-grid {
    grid-template-columns: 1fr;
  }
  
  .photo-upload {
    flex-direction: column;
    text-align: center;
  }
}
</style>

</head>
<body>

<div class="profile-wrapper">

  <h1 class="profile-title">プロフィール編集</h1>

  {% if message %}
    <p class="success-msg">{{ message }}</p>
  {% endif %}

  <form action="/staff/profile/edit" method="POST" enctype="multipart/form-data">
    
    <!-- 写真アップロード -->
    <div class="form-group">
      <label class="required">写真</label>
      <div class="photo-upload">
        {% if staff.profile_image_url %}
        <img src="{{ staff.profile_image_url }}" alt="プロフィール写真" class="photo-preview" id="photo-preview">
        {% else %}
        <img src="{{ url_for('static', filename='images/default_staff.png') }}" alt="プロフィール写真" class="photo-preview" id="photo-preview" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'120\' height=\'120\'%3E%3Crect width=\'120\' height=\'120\' fill=\'%23f5f5f5\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\' font-size=\'14\'%3E写真なし%3C/text%3E%3C/svg%3E'">
        {% endif %}
        <div class="photo-upload-info">
          <input type="file" name="profile_image" id="profile_image" accept="image/*" style="margin-bottom: 8px;" onchange="previewPhoto(this)">
          <p style="font-size: 0.85rem; color: #666; margin: 0;">推奨サイズ: 正方形（400×400px以上）</p>
          <p style="font-size: 0.85rem; color: #666; margin: 0;">対応形式: JPG, PNG</p>
        </div>
      </div>
    </div>

    <!-- 姓名（漢字） -->
    <div class="form-group form-row">
      <div>
        <label class="required">姓（漢字）</label>
        <input type="text" name="last_name" class="input" value="{{ staff.last_name or (staff.name.split(' ')[0] if staff.name and ' ' in staff.name else staff.name) }}" required>
      </div>
      <div>
        <label class="required">名（漢字）</label>
        <input type="text" name="first_name" class="input" value="{{ staff.first_name or (staff.name.split(' ')[1] if staff.name and ' ' in staff.name else '') }}" required>
      </div>
    </div>

    <!-- セイメイ -->
    <div class="form-group form-row">
      <div>
        <label>セイ</label>
        <input type="text" name="last_kana" class="input" value="{{ staff.last_kana or '' }}" placeholder="フリガナ">
      </div>
      <div>
        <label>メイ</label>
        <input type="text" name="first_kana" class="input" value="{{ staff.first_kana or '' }}" placeholder="フリガナ">
      </div>
    </div>

    <!-- 生年月日 -->
    <div class="form-group">
      <label>生年月日</label>
      <input type="date" name="birthday" class="input" value="{{ staff.birthday or '' }}">
    </div>

    <!-- 電話番号 -->
    <div class="form-group">
      <label>電話番号</label>
      <input type="tel" name="phone" class="input" value="{{ staff.phone or '' }}" placeholder="090-1234-5678">
    </div>

    <!-- 郵便番号・住所 -->
    <div class="form-group">
      <label>郵便番号</label>
      <input type="text" name="postal_code" class="input" value="{{ staff.postal_code or '' }}" placeholder="123-4567" pattern="[0-9]{3}-[0-9]{4}">
    </div>

    <div class="form-group">
      <label>住所</label>
      <input type="text" name="address" class="input" value="{{ staff.address or '' }}" placeholder="都道府県 市区町村 番地">
    </div>

    <!-- メールアドレス（変更不可） -->
    <div class="form-group">
      <label>メールアドレス（変更不可）</label>
      <input type="email" class="input" value="{{ staff.email }}" readonly>
    </div>

    <!-- 趣味や特技 -->
    <div class="form-group">
      <label>趣味や特技</label>
      <textarea name="hobbies_skills" class="textarea" placeholder="趣味や特技を入力してください">{{ staff.hobbies_skills or '' }}</textarea>
    </div>

    <!-- 可能手技選択 -->
    <div class="form-group">
      <label>可能手技選択</label>
      <div class="techniques-grid">
        {% for technique in treatment_options %}
        <div class="technique-checkbox">
          <input type="checkbox" name="available_techniques" id="technique_{{ loop.index }}" value="{{ technique }}" {% if staff.available_techniques and technique in staff.available_techniques %}checked{% endif %}>
          <label for="technique_{{ loop.index }}">{{ technique }}</label>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- 一言 -->
    <div class="form-group">
      <label>一言</label>
      <textarea name="one_word" class="textarea" rows="2" placeholder="自己紹介の一言を入力してください">{{ staff.one_word or '' }}</textarea>
    </div>

    <!-- ブログ用コメント -->
    <div class="form-group">
      <label>ブログ用コメント</label>
      <textarea name="blog_comment" class="textarea" rows="4" placeholder="ブログの著者紹介などに使用されるコメントを入力してください">{{ staff.blog_comment or '' }}</textarea>
    </div>

    <button type="submit" class="save-btn">保存する</button>

  </form>

  <div style="margin-top: 24px; text-align: center;">
    <a href="/staff/profile" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block;">← スタッフページに戻る</a>
  </div>
</div>

<script>
function previewPhoto(input) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('photo-preview').src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
  }
}
</script>

</body>
</html>
