{% extends "base.html" %}
{% block title %}å ±å‘Šæ›¸ä¸€è¦§ | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ“‹ å ±å‘Šæ›¸ä¸€è¦§</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
  <a href="/admin/reports/new" class="admin-karte-detail-btn-primary" style="text-decoration: none; display: inline-block; text-align: center;">ğŸ†• æ–°è¦å ±å‘Šæ›¸ä½œæˆ</a>
  {% if show_reports and selected_field_name %}
  <a href="/admin/reports" class="admin-karte-detail-btn-back" style="text-decoration: none; display: inline-block; text-align: center; margin-left: 12px;">â† ç¾å ´ä¸€è¦§ã«æˆ»ã‚‹</a>
  {% endif %}
</div>

{% if show_reports %}
  <!-- ç‰¹å®šç¾å ´ã®å ±å‘Šæ›¸ä¸€è¦§è¡¨ç¤º -->
  {% if selected_field_name %}
  <h3 style="margin: 0 0 20px 0; font-size: 1.3rem; font-weight: 600; color: #1E3A5F;">{{ selected_field_name }}ã®å ±å‘Šæ›¸</h3>
  {% endif %}
  
  {% if reports %}
  <div style="display: flex; flex-direction: column; gap: 16px;">
    {% for report in reports %}
    <div style="padding: 20px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
        <div style="flex: 1;">
          <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.9rem; color: #666; margin-bottom: 8px;">
            <span>ğŸ“… {{ report.report_date }}</span>
            {% if report.place %}
            <span>ğŸ“ {{ report.place }}</span>
            {% endif %}
            {% if report.staff_names %}
            <span>ğŸ‘¥ {{ report.staff_names | join(', ') }}</span>
            {% endif %}
          </div>
        </div>
        <div style="display: flex; gap: 8px;">
          <a href="/admin/reports/{{ report.id }}/edit" class="admin-karte-detail-btn-primary" style="text-decoration: none; padding: 8px 16px; font-size: 0.9rem;">âœ ç·¨é›†</a>
          <form action="/admin/reports/{{ report.id }}/delete" method="POST" style="display: inline;" onsubmit="return confirm('ã“ã®å ±å‘Šæ›¸ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
            <button type="submit" style="padding: 8px 16px; background: #f44336; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">ğŸ—‘ å‰Šé™¤</button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="color: #999; text-align: center; padding: 40px 0;">ã“ã®ç¾å ´ã®å ±å‘Šæ›¸ãŒã‚ã‚Šã¾ã›ã‚“</p>
  {% endif %}
{% else %}
  <!-- ç¾å ´ã”ã¨ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
  {% if field_names %}
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
    {% for field_name in field_names %}
    <div style="position: relative;">
      <a href="/admin/reports?field_name={{ field_name | urlencode }}" style="text-decoration: none; display: block;">
        <div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 18px rgba(0,0,0,0.08)';">
          <h3 style="margin: 0 0 12px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">{{ field_name }}</h3>
          <div style="font-size: 0.9rem; color: #666;">
            <span>å ±å‘Šæ›¸æ•°: {{ field_counts.get(field_name, 0) }}ä»¶</span>
          </div>
        </div>
      </a>
      <a href="/admin/reports/new?copy_from_field={{ field_name | urlencode }}" class="admin-karte-detail-btn-primary" style="text-decoration: none; display: inline-block; margin-top: 8px; padding: 8px 16px; font-size: 0.85rem; width: 100%; text-align: center; box-sizing: border-box;">ğŸ“‹ è¤‡è£½ã—ã¦æ–°è¦ä½œæˆ</a>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="color: #999; text-align: center; padding: 40px 0;">å ±å‘Šæ›¸ãŒã‚ã‚Šã¾ã›ã‚“</p>
  {% endif %}
{% endif %}

{% endblock %}
