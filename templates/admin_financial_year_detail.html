{% extends "base.html" %}
{% block title %}åæ”¯ç®¡ç† - {{ year }}å¹´ | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ’° åæ”¯ç®¡ç† - {{ year }}å¹´</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
  <a href="/admin/financial" class="admin-karte-detail-btn-back" style="text-decoration: none;">â† å¹´é¸æŠã«æˆ»ã‚‹</a>
  <a href="/admin/financial/years/{{ year }}/expenses/new" class="admin-karte-detail-btn-primary" style="text-decoration: none;">â• çµŒè²»è¿½åŠ </a>
</div>

<!-- å…¨ä½“åæ”¯ã‚µãƒãƒªãƒ¼ -->
<div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
  <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">{{ year }}å¹´ å…¨ä½“åæ”¯</h3>
  
  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
    <div style="padding: 20px; background: #e8f5e9; border-radius: 12px;">
      <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">ç·å£²ä¸Š</div>
      <div style="font-size: 1.8rem; font-weight: 600; color: #2e7d32;">Â¥{{ "{:,}".format(total_revenue|int) }}</div>
    </div>
    <div style="padding: 20px; background: #ffebee; border-radius: 12px;">
      <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">ç·çµŒè²»</div>
      <div style="font-size: 1.8rem; font-weight: 600; color: #c62828;">Â¥{{ "{:,}".format(total_expenses|int) }}</div>
    </div>
    <div style="padding: 20px; background: {% if total_profit >= 0 %}#e8f5e9{% else %}#ffebee{% endif %}; border-radius: 12px;">
      <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">åæ”¯</div>
      <div style="font-size: 1.8rem; font-weight: 600; color: {% if total_profit >= 0 %}#2e7d32{% else %}#c62828{% endif %};">
        Â¥{{ "{:,}".format(total_profit|int) }}
      </div>
    </div>
  </div>
</div>

<!-- ã‚¹ã‚¿ãƒƒãƒ•åˆ¥çµ¦ä¸ï¼ˆå¹´ï¼‰ -->
{% if staff_list %}
<div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
  <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">ã‚¹ã‚¿ãƒƒãƒ•åˆ¥çµ¦ä¸</h3>
  <div class="admin-karte-grid">
    {% for staff in staff_list %}
    <a href="/admin/financial/years/{{ year }}/staff/{{ staff.id | urlencode }}" class="admin-karte-card" style="text-decoration: none;">
      <div class="admin-karte-head">
        <strong class="admin-karte-name">{{ staff.name }}</strong>
      </div>
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- çµŒè²»ã‚«ãƒ†ã‚´ãƒªåˆ¥å†…è¨³ -->
<div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
  <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">çµŒè²»ã‚«ãƒ†ã‚´ãƒªåˆ¥å†…è¨³</h3>
  
  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f5f7fb;">
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; color: #1E3A5F;">ã‚«ãƒ†ã‚´ãƒª</th>
          <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; color: #1E3A5F;">é‡‘é¡</th>
        </tr>
      </thead>
      <tbody>
        {% set category_names = {
          'salary': 'çµ¦ä¸',
          'transportation': 'æ—…è²»äº¤é€šè²»',
          'travel': 'æ—…è²»äº¤é€šè²»',
          'social_insurance': 'ç¤¾ä¼šä¿é™ºæ–™',
          'rent': 'åœ°ä»£å®¶è³ƒ',
          'utilities': 'å…‰ç†±è²»',
          'communication': 'é€šä¿¡è²»',
          'insurance': 'ä¿é™ºæ–™',
          'lease': 'ãƒªãƒ¼ã‚¹æ–™',
          'tax': 'ç¨é‡‘',
          'accounting': 'çµŒç†ãƒ»ç¨ç†å£«è²»ç”¨',
          'advertising': 'åºƒå‘Šå®£ä¼è²»',
          'promotion': 'ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è²»ç”¨',
          'supplies': 'æ¶ˆè€—å“',
          'equipment': 'å‚™å“ãƒ»æ©Ÿå™¨',
          'office_supplies': 'äº‹å‹™ç”¨å“è²»',
          'repairs': 'ä¿®ç¹•è²»',
          'maintenance': 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è²»',
          'meeting': 'ä¼šè­°è²»',
          'entertainment': 'æ¥å¾…äº¤éš›è²»',
          'vehicle': 'è»Šä¸¡è²»',
          'depreciation': 'æ¸›ä¾¡å„Ÿå´è²»',
          'training': 'ç ”ä¿®è²»',
          'subscription': 'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³',
          'software': 'ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ»ã‚·ã‚¹ãƒ†ãƒ è²»ç”¨',
          'other': 'ãã®ä»–'
        } %}
        {% for category, amount in expense_by_category.items() %}
        <tr>
          <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ category_names.get(category, category) }}</td>
          <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">Â¥{{ "{:,}".format(amount|int) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- æœˆåˆ¥åæ”¯ -->
<div style="padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;">
  <h3 style="margin: 0 0 20px 0; font-size: 1.2rem; font-weight: 600; color: #1E3A5F;">æœˆåˆ¥åæ”¯</h3>
  
  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f5f7fb;">
          <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; color: #1E3A5F;">æœˆ</th>
          <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; color: #1E3A5F;">å£²ä¸Š</th>
          <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; color: #1E3A5F;">çµŒè²»</th>
          <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; color: #1E3A5F;">åæ”¯</th>
          <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd; color: #1E3A5F;">è©³ç´°</th>
        </tr>
      </thead>
      <tbody>
        {% for month in range(1, 13) %}
        <tr>
          <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ month_names[month] }}</td>
          <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">Â¥{{ "{:,}".format(monthly_revenue.get(month, 0)|int) }}</td>
          <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">Â¥{{ "{:,}".format(monthly_expenses.get(month, 0)|int) }}</td>
          <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee; font-weight: 600; color: {% if monthly_profit.get(month, 0) >= 0 %}#2e7d32{% else %}#c62828{% endif %};">
            Â¥{{ "{:,}".format(monthly_profit.get(month, 0)|int) }}
          </td>
          <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
            <a href="/admin/financial/years/{{ year }}/months/{{ '%02d'|format(month) }}" class="admin-karte-detail-btn-primary" style="text-decoration: none; padding: 6px 12px; font-size: 0.85rem;">è©³ç´°</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}

