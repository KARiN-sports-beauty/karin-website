{% extends "base.html" %}
{% block title %}ãƒ‹ãƒ¥ãƒ¼ã‚¹ç®¡ç† | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹ç®¡ç†</h2>

{% if get_flashed_messages() %}
  {% for message in get_flashed_messages(with_categories=true) %}
    <div class="admin-alert admin-alert-{{ message[0] }}" style="margin-bottom: 20px; padding: 12px; border-radius: 8px; background: {% if message[0] == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message[0] == 'success' %}#155724{% else %}#721c24{% endif %};">
      {{ message[1] }}
    </div>
  {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
  <a href="/admin/news/new" class="admin-news-btn">ğŸ†• æ–°è¦ãƒ‹ãƒ¥ãƒ¼ã‚¹ä½œæˆ</a>
</div>

{% if news_list %}
<div class="admin-news-grid">
  {% for news in news_list %}
  <div class="admin-news-card{% if news.draft %} replied{% else %} unread{% endif %}">
    <div class="admin-news-head">
      <strong>{{ news.title }}</strong>
      <span class="admin-news-date">{{ news.created_at | to_jst }}
      </span>
    </div>
    
    {% if news.category %}
    <p class="admin-news-category">ã‚«ãƒ†ã‚´ãƒª: {{ news.category }}</p>
    {% endif %}
    
    <p class="admin-news-body">
      {% if news.excerpt %}
        {{ news.excerpt[:30] }}{% if news.excerpt|length > 30 %}...{% endif %}
      {% else %}
      {{ news.body
        |striptags
        |replace("\n", "")
        |replace("&nbsp;", "")
        |truncate(40)
      }}
      {% endif %}
    </p>
    
    <div class="admin-news-actions">
      <span class="admin-news-status{% if news.draft %} draft{% else %} published{% endif %}">
        {% if news.draft %}ğŸ“ ä¸‹æ›¸ã{% else %}ğŸ“¢ å…¬é–‹{% endif %}
      </span>
      {% if news.slug %}
      <a href="/news/{{ news.slug }}" target="_blank" class="admin-news-view-link">ğŸ”— è¡¨ç¤º</a>
      {% endif %}
    </div>
    
    <div class="admin-news-buttons">
      <a href="/admin/news/edit/{{ news.id }}" class="reply-btn">âœ ç·¨é›†</a>
      <form action="/admin/news/delete/{{ news.id }}" method="POST" style="display: inline;" onsubmit="return confirm('ã“ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå…ƒã«ã¯æˆ»ã›ã¾ã›ã‚“ï¼‰');">
        <button type="submit" class="admin-news-delete-btn">ğŸ—‘ å‰Šé™¤</button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}

{% endblock %}
