{% extends "base.html" %}
{% block title %}ã‚«ãƒ«ãƒ†ç®¡ç† | KARiN.{% endblock %}

{% block content %}
<h2 class="admin-title">ğŸ“‹ ã‚«ãƒ«ãƒ†ç®¡ç†</h2>

<a href="/admin/karte/new" class="admin-karte-btn">â• æ–°è¦ã‚«ãƒ«ãƒ†ä½œæˆï¼ˆVIPç”¨ï¼‰</a>


<div style="margin-bottom: 20px;">
  <input type="text" id="karte-search" placeholder="åå‰ã§æ¤œç´¢..." style="width: 100%; max-width: 400px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
</div>

{% if patients %}
<div class="admin-karte-grid" id="karte-grid">
  {% for patient in patients %}
  <div class="admin-karte-card" data-name="{{ patient.name }}" data-kana="{{ patient.kana }}">
    <div class="admin-karte-head">
      <a href="/admin/karte/{{ patient.id }}" class="admin-karte-name-link">
        <strong>{{ patient.name }}</strong>
      </a>
    </div>
    
    <div class="admin-karte-info">
      <p class="admin-karte-field">
        <span class="admin-karte-label">ãƒ•ãƒªã‚¬ãƒŠï¼š</span>
        <span>{{ patient.kana }}</span>
      </p>
      
      <p class="admin-karte-field">
        <span class="admin-karte-label">å¹´é½¢ï¼š</span>
        <span>{{ patient.birthday | age_from_birthday if patient.birthday else 'æœªå…¥åŠ›' }}æ­³</span>
      </p>
      
      <p class="admin-karte-field">
        <span class="admin-karte-label">ç´¹ä»‹è€…ï¼š</span>
        {% if patient.introducer_info %}
          <a href="/admin/karte/{{ patient.introducer_info.id }}" class="admin-karte-introducer-link">
            {{ patient.introducer_info.name }}
          </a>
          <span class="admin-introducer-badge">{{ patient.introduced_count }}äººç´¹ä»‹</span>
        {% else %}
          <span>ãªã—</span>
        {% endif %}
      </p>
      
      <p class="admin-karte-field">
        <span class="admin-karte-label">æœ€çµ‚æ¥é™¢æ—¥ï¼š</span>
        <span>{{ patient.last_visit_date if patient.last_visit_date else 'æœªè¨˜éŒ²' }}</span>
      </p>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>æ‚£è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('karte-search');
  const grid = document.getElementById('karte-grid');
  const cards = grid ? Array.from(grid.querySelectorAll('.admin-karte-card')) : [];
  
  searchInput.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase().trim();
    
    cards.forEach(card => {
      const name = card.getAttribute('data-name') || '';
      const kana = card.getAttribute('data-kana') || '';
      const searchText = (name + ' ' + kana).toLowerCase();
      
      if (searchText.includes(query)) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  });
});
</script>

{% endblock %}
